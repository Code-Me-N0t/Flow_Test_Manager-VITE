import{j as e,H as B,i as ee,u as se,k as te,r as l,l as oe,m as ne,n as le,o as ae,M as re,C as ie,P as ce,F as f,b as de,p as ue,q as pe,s as xe,t as he,w as be,x as ge,Q as fe}from"./vendor-CGxnE9_9.js";import{B as Ce,V as me,M as je}from"./components-CNBhFxaL.js";const ye=({data:x,selected:n})=>{const{label:g,testCases:h,color:i}=x,c=h.length,b=n?"#2980B9":"#373737",s={background:n?"#373737":"#2980B9",width:"13px",height:"13px",border:"3px solid",borderColor:b},d={outline:`3px solid ${b}`,background:`${i||"#1c1c1e"}`};return e.jsxs("div",{className:"text-xs outline rounded relative p-2 text-[#ECF0F1] max-w-[150px] text-center",style:d,children:[e.jsx("div",{children:g}),e.jsx(B,{type:"source",position:"right",style:s}),e.jsx(B,{type:"target",position:"left",style:s}),c>0&&e.jsx("div",{className:"absolute top-[-10px] right-[-10px] w-[1.5rem] h-[1.5rem] rounded-full bg-[#E0E0E0] text-slate-700 flex items-center justify-center text-xs",children:c})]})},Ee=ye,we=({data:x,selected:n})=>{const{label:g}=x,h=n?"#2980B9":"#373737",c={background:n?"#373737":"#2980B9",width:"13px",height:"13px",border:"3px solid",borderColor:h},b={outline:`3px solid ${h}`};return e.jsxs("div",{className:"text-[#ECF0F1] text-xs rounded-full w-[50px] h-[50px] flex justify-center items-center bg-[#34495E]",style:b,children:[e.jsx("div",{children:g}),e.jsx(B,{type:"source",position:"right",style:c}),e.jsx(B,{type:"target",position:"left",style:c})]})},ke=we,ve=({id:x,sourceX:n,sourceY:g,targetX:h,targetY:i,sourcePosition:c,targetPosition:b,markerEnd:C,data:s})=>{const[d,m,z]=ee({sourceX:n,sourceY:g,targetX:h,targetY:i,sourcePosition:c,targetPosition:b});return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:x,className:"stroke-[#BDC3C7] stroke-[2] fill-none",d,markerEnd:C}),(s==null?void 0:s.label)&&e.jsx("text",{x:m,y:z,style:{fontSize:12},textAnchor:"middle",children:s.label})]})},Ne=ve;function ze(){var O,V,M;const[x,n,g]=se([]),[h,i,c]=te([]),[b,C]=l.useState(!1),[s,d]=l.useState(null),[m,z]=l.useState(null),{setViewport:N}=oe(),[P,T]=l.useState(!1),D=l.useCallback(()=>T(!0),[]),F=l.useCallback(()=>T(!1),[]),I={customNode:Ee,connector:ke},$={customEdge:Ne},[j,w]=l.useState({total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0}),[R,G]=l.useState(!1),k=l.useRef(null),q=l.useCallback(()=>{G(r=>!r)},[]),v=l.useCallback(r=>{const t={total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0};return r.forEach(o=>{o.data&&o.data.testCases&&o.data.testCases.forEach(a=>{t[a.status]!==void 0&&(t[a.status]+=1)})}),t.total=Object.values(t).reduce((o,a)=>o+a,0),t},[]),{addNode:J,addConnectorNode:L,exportToExcel:Q,deleteSelectedNode:U,onSave:W}=Ce(x,n,i,s,C,d,m,v);l.useEffect(()=>{(async()=>{try{const t=await fetch("https://code-me-n0t.github.io/TestFlowManager/flow.json");if(t.ok){const o=await t.json(),{x:a=0,y=0,zoom:E=1}=o.viewport||{},u=(o.nodes||[]).map(p=>{var H,A;return{...p,position:{x:typeof((H=p.position)==null?void 0:H.x)=="number"?p.position.x:0,y:typeof((A=p.position)==null?void 0:A.y)=="number"?p.position.y:0}}}),S=(o.edges||[]).map(p=>({...p}));n(u),i(S),N({x:a,y,zoom:E}),o.nodes&&w(v(o.nodes)),m&&m.fitView()}else console.warn("Failed to load flow data: Check the flow.json")}catch(t){console.error("Failed to load flow data:",t)}})()},[n,i,N,w,m]);const X=l.useCallback(r=>i(t=>ne({...r,animated:!0,type:"customEdge"},t)),[i]),Y=l.useCallback((r,t,o)=>{n(a=>{const y=a.map(u=>u.id===s.id?{...u,data:{...u.data,label:t,testCases:r,color:o},style:{...u.style,backgroundColor:o},type:"customNode"}:u),E=v(y);return w(E),y})},[s,n,w]),K=l.useCallback((r,t)=>{k.current?(clearTimeout(k.current),k.current=null,C(!0)):k.current=setTimeout(()=>{k.current=null},200),n(o=>o.map(a=>a.id===t.id?{...a,selected:!0}:{...a,selected:!1})),d(t)},[n]),Z=l.useCallback(()=>{C(!1),d(null)},[]),_=l.useCallback(r=>{try{const t=typeof r=="string"?JSON.parse(r):r,o=t.nodes||[],a=t.edges||[],y=t.viewport||{x:0,y:0,zoom:1};n(o),i(a),N(y);const E=s==null?void 0:s.id;if(E){const S=o.find(p=>p.id===E);d(S||null)}else d(null);const u=v(o);w(u),F()}catch(t){console.error("Error selecting version:",t)}},[s,n,i,N,v,F]);return e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(le,{colorMode:"dark",nodes:x,nodeTypes:I,onNodesChange:g,edges:h,edgeTypes:$,onEdgesChange:c,onConnect:X,onInit:z,fitView:!0,zoomOnScroll:!1,zoomOnDoubleClick:!1,onNodeClick:K,children:[e.jsx(ae,{}),e.jsx(re,{}),e.jsx(ie,{}),e.jsxs(ce,{position:"top-left panel",className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"button-container flex space-x-2",children:[e.jsx("button",{className:"delete p-2 rounded bg-[#3E3E3E] hover:bg-red-600 size-12",onClick:U,children:e.jsx(f,{icon:de,size:"lg",color:"white"})}),e.jsx("button",{className:"version-history p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:D,children:e.jsx(f,{icon:ue,size:"lg",color:"white"})}),e.jsx("button",{className:"download rounded rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:Q,children:e.jsx(f,{icon:pe,size:"lg",color:"white"})}),e.jsx("button",{className:"add p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:J,children:e.jsx(f,{icon:xe,size:"lg",color:"white"})}),e.jsx("button",{className:"connector p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:L,children:e.jsx(f,{icon:he,size:"lg",color:"white"})}),e.jsx("button",{className:"save p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:W,children:e.jsx(f,{icon:be,size:"lg",color:"white"})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-[#2d2d2d] opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Total Test Count: ",j.total]}),e.jsx("button",{className:"dropdown-button p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] flex items-center",onClick:q,children:e.jsx(f,{icon:ge,size:"lg",color:"white"})})]}),R&&e.jsxs("div",{className:"dropdown-menu mt-2 bg-[#2d2d2d] p-2 opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Not Started: ",j.notstarted]}),e.jsxs("p",{children:["Passed: ",j.passed]}),e.jsxs("p",{children:["Failed: ",j.failed]}),e.jsxs("p",{children:["Blocked: ",j.blocked]}),e.jsxs("p",{children:["Not Applicable: ",j.notapplicable]})]})]})]})]}),e.jsx(fe,{}),e.jsx(me,{isOpen:P,onClose:F,onSelectVersion:_}),e.jsx(je,{isOpen:b,onClose:Z,nodeId:s==null?void 0:s.id,nodeLabel:((O=s==null?void 0:s.data)==null?void 0:O.label)||"",testCases:((V=s==null?void 0:s.data)==null?void 0:V.testCases)||[],onSave:Y,borderColor:((M=s==null?void 0:s.data)==null?void 0:M.color)||"#1C1C1E"})]})}export{ze as default};
