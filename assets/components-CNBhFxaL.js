import{R as q,j as t,r as o,F as H,f as Q,a as X,b as Y,B as L,c as ee,d as te,v as J,E as se,e as oe}from"./vendor-CGxnE9_9.js";function ae(s,f){let i;return function(...d){clearTimeout(i),i=setTimeout(()=>s.apply(this,d),f)}}const le=q.memo(q.forwardRef(({testCase:s,onChange:f,onStatusChange:i,onCheckboxChange:d,isChecked:g,onClick:l},x)=>t.jsxs("div",{className:"py-2 flex items-center border-gray-600 space-x-5 overflow-x-hidden mr-3","data-replicated-value":s.content,onClick:l,children:[t.jsxs("label",{className:"container flex w-1",children:[t.jsx("input",{type:"checkbox",checked:g,onChange:d,className:"checkbox peer"}),t.jsx("span",{className:"checkmark rounded border border-gray-500 hover:border-gray-50 peer-checked:bg-sky-700 peer-checked:border-none"})]}),t.jsx("div",{className:`w-full ${s.status===""?"":"border-dashed border-x border-gray-700"}`,children:t.jsx("textarea",{ref:x,className:`px-3 bg-inherit rounded overflow-hidden resize-none w-full flex items-center 
              ${s.status===""?"text-gray-400 pl-2":"text-[#FAF9F6] pl-6"}  
              ${s.isBold?"bold-textarea focus:outline-none":"text-sm"}
            `,value:s.content,onChange:p=>f(p.target.value),placeholder:`Test case ${s.id}`,rows:s.status===""?1:""})}),s.status!==""&&t.jsxs("select",{className:`p-1 cursor-pointer text-sm rounded focus:outline-none ${s.status==="notstarted"?"bg-yellow-200":s.status==="passed"?"bg-green-200":s.status==="failed"?"bg-rose-300":s.status==="blocked"?"bg-indigo-200":s.status==="notapplicable"?"bg-gray-300":"bg-yellow-200"}`,value:s.status,onChange:p=>i(p.target.value),children:[t.jsx("option",{className:"bg-slate-200",value:"notstarted",children:"NOT STARTED"}),t.jsx("option",{className:"bg-slate-200",value:"passed",children:"PASSED"}),t.jsx("option",{className:"bg-slate-200",value:"failed",children:"FAILED"}),t.jsx("option",{className:"bg-slate-200",value:"blocked",children:"BLOCKED"}),t.jsx("option",{className:"bg-slate-200",value:"notapplicable",children:"NOT APPLICABLE"})]})]},s.id))),w={DEFAULT:"#1C1C1E",SECOND:"#F39F5A",THIRD:"#9D3233"},re=({isOpen:s,onClose:f,nodeId:i,nodeLabel:d,nodeColor:g="#1C1C1E",testCases:l,onSave:x})=>{const[p,$]=o.useState(d),[k,S]=o.useState(g||w.DEFAULT),[u,N]=o.useState(l),[T,P]=o.useState([]),C=o.useRef([]),[z,h]=o.useState(g||w.DEFAULT),[r,m]=o.useState(""),[j,b]=o.useState(!1);o.useEffect(()=>{N(l)},[l,i]);const v={toastSave:()=>{L.success("Changes Saved Successfully!",{autoClose:1e3})},toastSaveError:()=>{L.error("Failed to save data. Please try again.",{autoClose:1e3})}},E=o.useCallback(ae(async()=>{try{if(!i)throw new Error("Node ID is not defined");const e=u.length,a=u.filter(B=>B.status==="passed").length,n=u.filter(B=>B.status==="failed").length,y=u.filter(B=>B.status==="notstarted").length,V=u.filter(B=>B.status==="notapplicable").length;x&&x(u,p,k,{total:e,passed:a,failed:n,pending:y,notApplicable:V}),v.toastSave()}catch(e){console.error("Failed to save data:",e),v.toastSaveError()}},1e3),[u,p,k,i,x,v]),c=o.useCallback(()=>{requestAnimationFrame(()=>{const e=C.current.map(a=>a?(a.style.height="auto",a.scrollHeight):0);C.current.forEach((a,n)=>{a&&(a.style.height=`${e[n]}px`)})})},[]),D=o.useCallback(()=>{c(),E()},[c,E]),R=o.useCallback(e=>{const a=e.target.value;/^#[0-9A-Fa-f]{6}$/.test(a)?(S(a),h(a)):console.error("Invalid color format. Please use #rrggbb format.")},[]),U=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"",isBold:!0};N(a=>[...a,e])},[]),A=o.useCallback((e,a)=>{N(n=>n.map(y=>y.id===e?{...y,content:a}:y))},[]),F=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"notstarted"};N(a=>[...a,e])},[]),I=o.useCallback((e,a)=>{N(n=>n.map(y=>y.id===e?{...y,status:a}:y))},[]),O=o.useCallback(()=>{N(e=>e.filter(a=>!T.includes(a.id))),P([])},[T]),W=o.useCallback(e=>{if(e.target.checked){const a=u.map(n=>n.id);P(a)}else P([])},[u]),Z=o.useCallback(e=>{P(a=>a.includes(e)?a.filter(n=>n!==e):[...a,e])},[]),M=u.filter(e=>e.content.toLowerCase().includes(r.toLowerCase())),_=o.useCallback(e=>{C.current[e]&&(C.current[e].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),C.current[e].focus())},[]),G=o.useCallback(e=>{r&&(m(""),setTimeout(()=>{_(e)},0))},[r,_]);o.useEffect(()=>{s&&($(d),S(g||w.DEFAULT),N(l),P([]))},[d,l,g,s]),o.useEffect(()=>{const e=JSON.parse(localStorage.getItem(`testCases-${i}`)),a=localStorage.getItem(`label-${i}`),n=localStorage.getItem(`color-${i}`);a&&$(a),e&&N(e),n&&(S(n),h(n)),setTimeout(()=>{document.querySelectorAll(".modal-content textarea").forEach(V=>{V.parentNode.dataset.replicatedValue=V.value})},0)},[i,s]);const K=o.useCallback(e=>{j||(e.ctrlKey&&e.key==="Enter"?(r&&m(""),F(),b(!0)):e.altKey&&e.key==="Enter"?(r&&m(""),U(),b(!0)):e.ctrlKey&&e.key.toLowerCase()==="s"?(e.preventDefault(),document.querySelector(".modal-save").focus(),D(),b(!0)):e.ctrlKey&&e.key.toLowerCase()==="f"&&(e.preventDefault(),document.querySelector(".search-input").focus(),b(!0)),setTimeout(()=>{b(!1)},100))},[r,F,U,j]);return o.useEffect(()=>(document.addEventListener("keydown",K),()=>{document.removeEventListener("keydown",K)}),[K]),o.useEffect(()=>{s&&c()},[s,c]),o.useEffect(()=>{var e;C.current.length>0&&(C.current.forEach(a=>{a&&(a.style.height="auto")}),(e=C.current[C.current.length-1])==null||e.focus())},[u.length]),o.useEffect(()=>{const e=document.querySelector(".modal-content");e&&(e.style.borderTopColor=z)},[z]),t.jsx(t.Fragment,{children:s&&t.jsx("div",{className:"modal-overlay z-0 select-none",children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[800px] border-t-4",style:{borderColor:k},children:[t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:f,children:"×"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"text",className:"bg-inherit text-slate-200 font-bold p-1 rounded mr-5 w-2/3 text-xl focus:outline focus:outline-white",value:p,onChange:e=>$(e.target.value),placeholder:"Node Label"}),t.jsxs("div",{className:"flex items-center w-fit space-x-3 px-2 ml-10",children:[t.jsx("button",{onClick:()=>R({target:{value:w.DEFAULT}}),className:`w-8 h-8 rounded border-2 ${k===w.DEFAULT?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:w.DEFAULT},"aria-label":"DEFAULT"}),t.jsx("button",{onClick:()=>R({target:{value:w.SECOND}}),className:`w-8 h-8 rounded border-2 ${k===w.SECOND?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:w.SECOND},"aria-label":"SECOND"}),t.jsx("button",{onClick:()=>R({target:{value:w.THIRD}}),className:`w-8 h-8 rounded border-2 ${k===w.THIRD?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:w.THIRD},"aria-label":"THIRD"})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"p-2 rounded flex items-center border-gray-600 cursor-pointer space-x-4 ",children:[t.jsx("input",{type:"checkbox",onChange:W,checked:T.length===u.length&&u.length>0}),t.jsx("span",{className:"text-white",children:"Select All"})]}),t.jsx("input",{type:"text",className:"search-input placeholder:italic p-1 px-3 text-sm text-white rounded border border-gray-600 bg-inherit",placeholder:"Search keywords...",value:r,onChange:e=>m(e.target.value)})]}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"}),r&&t.jsxs("label",{className:"text-gray-400 text-xs",children:[M.length," test case",M.length>1?"s":""," found"]}),t.jsx("div",{className:"modal-body overflow-y-auto pb-[10px] divide-y divide-dashed",children:M.map((e,a)=>t.jsx(le,{testCase:e,onChange:n=>A(e.id,n),onStatusChange:n=>I(e.id,n),onCheckboxChange:()=>Z(e.id),isChecked:T.includes(e.id),ref:n=>C.current[u.findIndex(y=>y.id===e.id)]=n,onClick:()=>G(u.findIndex(n=>n.id===e.id))},e.id))}),t.jsxs("div",{className:"button-container sticky bottom-0 left-0 right-0 bg-[#1C1C1E] pt-5 space-x-3 z-10",children:[t.jsx("button",{className:"p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:F,children:t.jsx(H,{icon:Q,size:"lg",color:"white"})}),t.jsx("button",{className:"modal-save p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:D,children:t.jsx(H,{icon:X,size:"lg",color:"white"})}),t.jsx("button",{className:`p-2 rounded w-12 ${T.length>0?"bg-red-600 hover:bg-red-800":"bg-gray-600 cursor-not-allowed"}`,onClick:O,disabled:T.length===0,style:{cursor:T.length===0?"not-allowed":"pointer"},children:t.jsx(H,{icon:Y,size:"lg",color:"white"})})]})]})})})},he=re,ne=({isOpen:s,onClose:f,onSelectVersion:i})=>{const[d,g]=o.useState([]);return o.useEffect(()=>{s&&fetch("http://localhost:3000/versions.json").then(l=>{if(!l.ok)throw new Error("Failed to fetch flow data");return l.json()}).then(l=>{if(l.versions){const p=l.versions.sort(($,k)=>new Date(k.timestamp)-new Date($.timestamp));g(p)}else console.error("Invalid data structure:",l)}).catch(l=>{console.error("Failed to fetch versions:",l)})},[s]),s?t.jsx("div",{className:"modal-overlay z-0 select-none text-slate-200",onClick:f,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[500px]",onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{className:"font-bold text-xl",children:"Version History"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:f,children:"×"}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"})]}),t.jsx("div",{className:"modal-body divide-y divide-dashed ",children:d.length===0?t.jsx("p",{children:"No versions available."}):t.jsx("ul",{className:"space-y-3 peer",children:d.map((l,x)=>t.jsx("li",{children:t.jsxs("button",{className:"link-button border border-gray-600 w-full px-2 text-right pr-7 py-2 rounded hover:bg-gray-800 hover:border-white",onClick:()=>i(l.flowData),children:[t.jsx(H,{icon:ee,className:"float-left peer-hover:pl-10",size:"lg",color:"white"}),te(new Date(l.timestamp),"MMMM dd, h:mm a")]})},x))})})]})}):null},fe=ne,ce=()=>{const s=o.useCallback(()=>{L.error("No node selected to delete.",{autoClose:1e3})},[]),f=o.useCallback(()=>{L.success("Node Deleted.",{autoClose:1e3})},[]),i=o.useCallback(()=>{L.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),d=o.useCallback(()=>{L.success("Changes saved successfully!",{autoClose:1e3})},[]),g=o.useCallback(()=>{L.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),l=o.useCallback(()=>{L.success("Changes saved locally!",{autoClose:1e3})},[]);return{toastDelete:s,toastDeleteSuccess:f,toastSaveError:i,toastSaveSuccess:d,toastSaveErrorLocal:g,toastSaveLocalSuccess:l}},ie=(s,f,i,d,g,l,x,p)=>{const{toastDelete:$,toastDeleteSuccess:k,toastSaveError:S,toastSaveSuccess:u}=ce(),N=o.useCallback(()=>{const h=s[s.length-1],r=h?h.position:{x:0,y:0},m={id:J(),position:{x:r.x+100,y:r.y+100},data:{label:`Test Scenario ${s.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};f(j=>[...j,m])},[s,f]),T=o.useCallback(()=>{const h=s[s.length-1],r=h?h.position:{x:0,y:0},m={id:J(),position:{x:r.x+100,y:r.y+100},type:"connector",data:{label:`${s.length+1}`},sourcePosition:"right",targetPosition:"left"};f(j=>[...j,m])},[s,f]),P=o.useCallback(async()=>{console.time("Export to Excel");const h=new se.Workbook,r=new Set,m=v=>{const E=v.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let c=E,D=1;for(;r.has(c);)c=`${E}_${D}`,D++,c.length>31&&(c=c.slice(0,31));return r.add(c),c};for(const v of s)if(v.data.testCases&&v.data.testCases.length>0){const E=v.data.label||`Sheet${s.indexOf(v)+1}`,c=m(E),D=v.data.testCases||[];console.log(`Processing node: ${E}`),console.log("Test Cases:",D);const R=h.addWorksheet(c);R.addRow(["Test ID","Test Case","Status"]),D.forEach((A,F)=>{R.addRow([F+1,A.content,A.status,A.description||""])}),(()=>{R.columns.forEach(A=>{let F=0;A.eachCell({includeEmpty:!0},I=>{const O=I.value?I.value.toString().length:0;O>F&&(F=O)}),A.width=F})})(),console.timeEnd(`Creating sheet for ${c}`)}console.timeEnd("Export to Excel");const j=await h.xlsx.writeBuffer(),b=new Blob([j],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});oe.saveAs(b,"test_cases.xlsx"),console.log("File saved!")},[s]),C=o.useCallback(()=>{d?(f(h=>h.filter(r=>r.id!==d.id)),i(h=>h.filter(r=>r.source!==d.id&&r.target!==d.id)),k(),g(!1),l(null)):$()},[d,f,i,g]),z=o.useCallback(()=>{if(x){const h=x.toObject(),r=p(h.nodes),m=JSON.stringify({...h,testCaseStats:r},null,4),j=b=>{const E={timestamp:new Date().toISOString(),flowData:b};fetch("http://localhost:3000/flow/saveVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)}).then(c=>c.json()).then(c=>{c?console.log("Version saved to server:",c.message):S()}).catch(c=>{console.error("Failed to save version to server:",c),S()})};fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:m}).then(b=>b.json()).then(b=>{b?(u(),j(m)):S()}).catch(b=>{console.error("Failed to save flow data to server:",b),S()})}else S()},[x,p,S,u]);return{addNode:N,addConnectorNode:T,exportToExcel:P,deleteSelectedNode:C,onSave:z}},be=ie;export{be as B,he as M,fe as V};
