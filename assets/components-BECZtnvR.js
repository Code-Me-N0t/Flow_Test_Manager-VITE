import{R as q,j as t,F as z,f as Q,B as F,r as o,a as X,b as Y,c as ee,d as te,e as se,v as J,E as oe,g as ae}from"./vendor-pJCnScHx.js";function le(s,f){let i;return function(...d){clearTimeout(i),i=setTimeout(()=>s.apply(this,d),f)}}const re=q.memo(q.forwardRef(({testCase:s,onChange:f,onStatusChange:i,onCheckboxChange:d,isChecked:m,onClick:l},p)=>{const S=async()=>{try{if((await fetch("http://localhost:3000/run-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testCaseId:s.id})})).ok)F.success("Python script executed successfully!",{autoClose:1e3});else throw new Error("Failed to execute script")}catch(b){console.error("Error running Python script:",b),F.error("Failed to execute Python script.",{autoClose:1e3})}};return t.jsxs("div",{className:"py-2 flex items-center border-gray-600 space-x-5 overflow-x-hidden mr-3","data-replicated-value":s.content,onClick:l,children:[t.jsxs("label",{className:"container flex w-1",children:[t.jsx("input",{type:"checkbox",checked:m,onChange:d,className:"checkbox peer"}),t.jsx("span",{className:"checkmark rounded border border-gray-500 hover:border-gray-50 peer-checked:bg-sky-700 peer-checked:border-none"})]}),t.jsx("div",{className:`w-full ${s.status===""?"":"border-dashed border-x border-gray-700"}`,children:t.jsx("textarea",{ref:p,className:`px-3 bg-inherit rounded overflow-hidden resize-none w-full flex items-center 
              ${s.status===""?"text-gray-400 pl-2":"text-[#FAF9F6] pl-6"}  
              ${s.isBold?"bold-textarea focus:outline-none":"text-sm"}
            `,value:s.content,onChange:b=>f(b.target.value),placeholder:`Test case ${s.id}`,rows:s.status===""?1:""})}),s.status!==""&&t.jsxs("select",{className:`p-1 cursor-pointer text-sm rounded focus:outline-none ${s.status==="notstarted"?"bg-yellow-200":s.status==="passed"?"bg-green-200":s.status==="failed"?"bg-rose-300":s.status==="blocked"?"bg-indigo-200":s.status==="notapplicable"?"bg-gray-300":"bg-yellow-200"}`,value:s.status,onChange:b=>i(b.target.value),children:[t.jsx("option",{className:"bg-slate-200",value:"notstarted",children:"NOT STARTED"}),t.jsx("option",{className:"bg-slate-200",value:"passed",children:"PASSED"}),t.jsx("option",{className:"bg-slate-200",value:"failed",children:"FAILED"}),t.jsx("option",{className:"bg-slate-200",value:"blocked",children:"BLOCKED"}),t.jsx("option",{className:"bg-slate-200",value:"notapplicable",children:"NOT APPLICABLE"})]}),s.status!=""&&t.jsx("button",{className:"automate p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:S,children:t.jsx(z,{icon:Q,size:"lg",color:"white"})})]},s.id)})),w={DEFAULT:"#1C1C1E",SECOND:"#F39F5A",THIRD:"#9D3233"},ne=({isOpen:s,onClose:f,nodeId:i,nodeLabel:d,nodeColor:m="#1C1C1E",testCases:l,onSave:p})=>{const[S,b]=o.useState(d),[k,N]=o.useState(m||w.DEFAULT),[u,j]=o.useState(l),[D,P]=o.useState([]),C=o.useRef([]),[I,h]=o.useState(m||w.DEFAULT),[r,x]=o.useState(""),[E,g]=o.useState(!1);o.useEffect(()=>{j(l)},[l,i]);const y={toastSave:()=>{F.success("Changes Saved Successfully!",{autoClose:1e3})},toastSaveError:()=>{F.error("Failed to save data. Please try again.",{autoClose:1e3})}},T=o.useCallback(le(async()=>{try{if(!i)throw new Error("Node ID is not defined");const e=u.length,a=u.filter(B=>B.status==="passed").length,n=u.filter(B=>B.status==="failed").length,v=u.filter(B=>B.status==="notstarted").length,H=u.filter(B=>B.status==="notapplicable").length;p&&p(u,S,k,{total:e,passed:a,failed:n,pending:v,notApplicable:H}),y.toastSave()}catch(e){console.error("Failed to save data:",e),y.toastSaveError()}},1e3),[u,S,k,i,p,y]),c=o.useCallback(()=>{requestAnimationFrame(()=>{const e=C.current.map(a=>a?(a.style.height="auto",a.scrollHeight):0);C.current.forEach((a,n)=>{a&&(a.style.height=`${e[n]}px`)})})},[]),L=o.useCallback(()=>{c(),T()},[c,T]),R=o.useCallback(e=>{const a=e.target.value;/^#[0-9A-Fa-f]{6}$/.test(a)?(N(a),h(a)):console.error("Invalid color format. Please use #rrggbb format.")},[]),U=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"",isBold:!0};j(a=>[...a,e])},[]),$=o.useCallback((e,a)=>{j(n=>n.map(v=>v.id===e?{...v,content:a}:v))},[]),A=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"notstarted"};j(a=>[...a,e])},[]),O=o.useCallback((e,a)=>{j(n=>n.map(v=>v.id===e?{...v,status:a}:v))},[]),V=o.useCallback(()=>{j(e=>e.filter(a=>!D.includes(a.id))),P([])},[D]),W=o.useCallback(e=>{if(e.target.checked){const a=u.map(n=>n.id);P(a)}else P([])},[u]),Z=o.useCallback(e=>{P(a=>a.includes(e)?a.filter(n=>n!==e):[...a,e])},[]),M=u.filter(e=>e.content.toLowerCase().includes(r.toLowerCase())),_=o.useCallback(e=>{C.current[e]&&(C.current[e].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),C.current[e].focus())},[]),G=o.useCallback(e=>{r&&(x(""),setTimeout(()=>{_(e)},0))},[r,_]);o.useEffect(()=>{s&&(b(d),N(m||w.DEFAULT),j(l),P([]))},[d,l,m,s]),o.useEffect(()=>{const e=JSON.parse(localStorage.getItem(`testCases-${i}`)),a=localStorage.getItem(`label-${i}`),n=localStorage.getItem(`color-${i}`);a&&b(a),e&&j(e),n&&(N(n),h(n)),setTimeout(()=>{document.querySelectorAll(".modal-content textarea").forEach(H=>{H.parentNode.dataset.replicatedValue=H.value})},0)},[i,s]);const K=o.useCallback(e=>{E||(e.ctrlKey&&e.key==="Enter"?(r&&x(""),A(),g(!0)):e.altKey&&e.key==="Enter"?(r&&x(""),U(),g(!0)):e.ctrlKey&&e.key.toLowerCase()==="s"?(e.preventDefault(),document.querySelector(".modal-save").focus(),L(),g(!0)):e.ctrlKey&&e.key.toLowerCase()==="f"&&(e.preventDefault(),document.querySelector(".search-input").focus(),g(!0)),setTimeout(()=>{g(!1)},100))},[r,A,U,E]);return o.useEffect(()=>(document.addEventListener("keydown",K),()=>{document.removeEventListener("keydown",K)}),[K]),o.useEffect(()=>{s&&c()},[s,c]),o.useEffect(()=>{var e;C.current.length>0&&(C.current.forEach(a=>{a&&(a.style.height="auto")}),(e=C.current[C.current.length-1])==null||e.focus())},[u.length]),o.useEffect(()=>{const e=document.querySelector(".modal-content");e&&(e.style.borderTopColor=I)},[I]),t.jsx(t.Fragment,{children:s&&t.jsx("div",{className:"modal-overlay z-0 select-none",children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[800px] border-t-4",style:{borderColor:k},children:[t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:f,children:"×"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"text",className:"bg-inherit text-slate-200 font-bold p-1 rounded mr-5 w-2/3 text-xl focus:outline focus:outline-white",value:S,onChange:e=>b(e.target.value),placeholder:"Node Label"}),t.jsxs("div",{className:"flex items-center w-fit space-x-3 px-2 ml-10",children:[t.jsx("button",{onClick:()=>R({target:{value:w.DEFAULT}}),className:`w-8 h-8 rounded border-2 ${k===w.DEFAULT?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:w.DEFAULT},"aria-label":"DEFAULT"}),t.jsx("button",{onClick:()=>R({target:{value:w.SECOND}}),className:`w-8 h-8 rounded border-2 ${k===w.SECOND?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:w.SECOND},"aria-label":"SECOND"}),t.jsx("button",{onClick:()=>R({target:{value:w.THIRD}}),className:`w-8 h-8 rounded border-2 ${k===w.THIRD?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:w.THIRD},"aria-label":"THIRD"})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"p-2 rounded flex items-center border-gray-600 cursor-pointer space-x-4 ",children:[t.jsx("input",{type:"checkbox",onChange:W,checked:D.length===u.length&&u.length>0}),t.jsx("span",{className:"text-white",children:"Select All"})]}),t.jsx("input",{type:"text",className:"search-input placeholder:italic p-1 px-3 text-sm text-white rounded border border-gray-600 bg-inherit",placeholder:"Search keywords...",value:r,onChange:e=>x(e.target.value)})]}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"}),r&&t.jsxs("label",{className:"text-gray-400 text-xs",children:[M.length," test case",M.length>1?"s":""," found"]}),t.jsx("div",{className:"modal-body overflow-y-auto pb-[10px] divide-y divide-dashed",children:M.map((e,a)=>t.jsx(re,{testCase:e,onChange:n=>$(e.id,n),onStatusChange:n=>O(e.id,n),onCheckboxChange:()=>Z(e.id),isChecked:D.includes(e.id),ref:n=>C.current[u.findIndex(v=>v.id===e.id)]=n,onClick:()=>G(u.findIndex(n=>n.id===e.id))},e.id))}),t.jsxs("div",{className:"button-container sticky bottom-0 left-0 right-0 bg-[#1C1C1E] pt-5 space-x-3 z-10",children:[t.jsx("button",{className:"p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:A,children:t.jsx(z,{icon:X,size:"lg",color:"white"})}),t.jsx("button",{className:"modal-save p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:L,children:t.jsx(z,{icon:Y,size:"lg",color:"white"})}),t.jsx("button",{className:`p-2 rounded w-12 ${D.length>0?"bg-red-600 hover:bg-red-800":"bg-gray-600 cursor-not-allowed"}`,onClick:V,disabled:D.length===0,style:{cursor:D.length===0?"not-allowed":"pointer"},children:t.jsx(z,{icon:ee,size:"lg",color:"white"})})]})]})})})},fe=ne,ce=({isOpen:s,onClose:f,onSelectVersion:i})=>{const[d,m]=o.useState([]);return o.useEffect(()=>{s&&fetch("http://localhost:3000/versions.json").then(l=>{if(!l.ok)throw new Error("Failed to fetch flow data");return l.json()}).then(l=>{if(l.versions){const S=l.versions.sort((b,k)=>new Date(k.timestamp)-new Date(b.timestamp));m(S)}else console.error("Invalid data structure:",l)}).catch(l=>{console.error("Failed to fetch versions:",l)})},[s]),s?t.jsx("div",{className:"modal-overlay z-0 select-none text-slate-200",onClick:f,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[500px]",onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{className:"font-bold text-xl",children:"Version History"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:f,children:"×"}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"})]}),t.jsx("div",{className:"modal-body divide-y divide-dashed ",children:d.length===0?t.jsx("p",{children:"No versions available."}):t.jsx("ul",{className:"space-y-3 peer",children:d.map((l,p)=>t.jsx("li",{children:t.jsxs("button",{className:"link-button border border-gray-600 w-full px-2 text-right pr-7 py-2 rounded hover:bg-gray-800 hover:border-white",onClick:()=>i(l.flowData),children:[t.jsx(z,{icon:te,className:"float-left peer-hover:pl-10",size:"lg",color:"white"}),se(new Date(l.timestamp),"MMMM dd, h:mm a")]})},p))})})]})}):null},ge=ce,ie=()=>{const s=o.useCallback(()=>{F.error("No node selected to delete.",{autoClose:1e3})},[]),f=o.useCallback(()=>{F.success("Node Deleted.",{autoClose:1e3})},[]),i=o.useCallback(()=>{F.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),d=o.useCallback(()=>{F.success("Changes saved successfully!",{autoClose:1e3})},[]),m=o.useCallback(()=>{F.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),l=o.useCallback(()=>{F.success("Changes saved locally!",{autoClose:1e3})},[]);return{toastDelete:s,toastDeleteSuccess:f,toastSaveError:i,toastSaveSuccess:d,toastSaveErrorLocal:m,toastSaveLocalSuccess:l}},de=(s,f,i,d,m,l,p,S)=>{const{toastDelete:b,toastDeleteSuccess:k,toastSaveError:N,toastSaveSuccess:u}=ie(),j=o.useCallback(()=>{const h=s[s.length-1],r=h?h.position:{x:0,y:0},x={id:J(),position:{x:r.x+100,y:r.y+100},data:{label:`Test Scenario ${s.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};f(E=>[...E,x])},[s,f]),D=o.useCallback(()=>{const h=s[s.length-1],r=h?h.position:{x:0,y:0},x={id:J(),position:{x:r.x+100,y:r.y+100},type:"connector",data:{label:`${s.length+1}`},sourcePosition:"right",targetPosition:"left"};f(E=>[...E,x])},[s,f]),P=o.useCallback(async()=>{console.time("Export to Excel");const h=new oe.Workbook,r=new Set,x=y=>{const T=y.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let c=T,L=1;for(;r.has(c);)c=`${T}_${L}`,L++,c.length>31&&(c=c.slice(0,31));return r.add(c),c};for(const y of s)if(y.data.testCases&&y.data.testCases.length>0){const T=y.data.label||`Sheet${s.indexOf(y)+1}`,c=x(T),L=y.data.testCases||[];console.log(`Processing node: ${T}`),console.log("Test Cases:",L);const R=h.addWorksheet(c);R.addRow(["Test ID","Test Case","Status"]),L.forEach(($,A)=>{R.addRow([A+1,$.content,$.status,$.description||""])}),(()=>{R.columns.forEach($=>{let A=0;$.eachCell({includeEmpty:!0},O=>{const V=O.value?O.value.toString().length:0;V>A&&(A=V)}),$.width=A})})(),console.timeEnd(`Creating sheet for ${c}`)}console.timeEnd("Export to Excel");const E=await h.xlsx.writeBuffer(),g=new Blob([E],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ae.saveAs(g,"test_cases.xlsx"),console.log("File saved!")},[s]),C=o.useCallback(()=>{d?(f(h=>h.filter(r=>r.id!==d.id)),i(h=>h.filter(r=>r.source!==d.id&&r.target!==d.id)),k(),m(!1),l(null)):b()},[d,f,i,m]),I=o.useCallback(()=>{if(p){const h=p.toObject(),r=S(h.nodes),x=JSON.stringify({...h,testCaseStats:r},null,4),E=g=>{const T={timestamp:new Date().toISOString(),flowData:g};fetch("http://localhost:3000/flow/saveVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)}).then(c=>c.json()).then(c=>{c?console.log("Version saved to server:",c.message):N()}).catch(c=>{console.error("Failed to save version to server:",c),N()})};fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:x}).then(g=>g.json()).then(g=>{g?(u(),E(x)):N()}).catch(g=>{console.error("Failed to save flow data to server:",g),N()})}else N()},[p,S,N,u]);return{addNode:j,addConnectorNode:D,exportToExcel:P,deleteSelectedNode:C,onSave:I}},be=de;export{be as B,fe as M,ge as V};
