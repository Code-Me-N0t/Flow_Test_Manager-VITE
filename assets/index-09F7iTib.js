import{j as e,H as D,g as oe,u as ae,c as le,r as c,d as ne,B as j,e as ce,v as q,E as re,h as ie,i as de,k as ue,M as pe,C as fe,P as he,F as v,b as xe,l as ge,m as be,n as me,o as Ce,p as ye,Q as we,q as Ee,R as Se,s as je}from"./vendor-CZYFqIWd.js";import{M as ve}from"./components-Dz6Tx3kz.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))f(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const C of d.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&f(C)}).observe(document,{childList:!0,subtree:!0});function m(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function f(s){if(s.ep)return;s.ep=!0;const d=m(s);fetch(s.href,d)}})();const ke=({data:u,selected:r})=>{const{label:m,testCases:f,color:s}=u,d=f.length;return e.jsxs("div",{className:`text-xs outline rounded relative p-2 text-[#ECF0F1] max-w-[150px] text-center ${r?"outline-[#2980B9]":"outline-[#373737]"}`,children:[e.jsx("div",{children:m}),e.jsx(D,{type:"source",position:"right"}),e.jsx(D,{type:"target",position:"left"}),d>0&&e.jsx("div",{className:"absolute top-[-10px] right-[-10px] w-[20px] h-[20px] rounded-full bg-[#E0E0E0] text-slate-700 flex items-center justify-center text-xs",children:d})]})},Ne=({data:u})=>e.jsxs("div",{className:"text-[#ECF0F1] text-xs rounded-full w-[50px] h-[50px] flex justify-center items-center bg-[#34495E]",children:[e.jsx("div",{children:u.label}),e.jsx(D,{type:"source",position:"right"}),e.jsx(D,{type:"target",position:"left"})]}),Fe=({id:u,sourceX:r,sourceY:m,targetX:f,targetY:s,sourcePosition:d,targetPosition:C,markerEnd:k,data:l})=>{const[N,h,O]=oe({sourceX:r,sourceY:m,targetX:f,targetY:s,sourcePosition:d,targetPosition:C});return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:u,className:"stroke-[#BDC3C7] stroke-[2] fill-none",d:N,markerEnd:k}),(l==null?void 0:l.label)&&e.jsx("text",{x:h,y:O,style:{fontSize:12},textAnchor:"middle",children:l.label})]})};function ze(){var R,A,I;const[u,r,m]=ae([]),[f,s,d]=le([]),[C,k]=c.useState(!1),[l,N]=c.useState(null),[h,O]=c.useState(null),{setViewport:M}=ne(),V={customNode:ke,connector:Ne},W={customEdge:Fe},y={toastDelete:c.useCallback(()=>{j.error("No node selected to delete.",{autoClose:1e3})},[]),toastDeleteSuccess:c.useCallback(()=>{j.success("Node Deleted.",{autoClose:1e3})},[]),toastSaveError:c.useCallback(()=>{j.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),toastSaveSuccess:c.useCallback(()=>{j.success("Changes saved successfully!",{autoClose:1e3})},[]),toastSaveErrorLocal:c.useCallback(()=>{j.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),toastSaveLocalSuccess:c.useCallback(()=>{j.success("Changes saved locally!",{autoClose:1e3})},[])},[w,P]=c.useState({total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0}),[H,J]=c.useState(!1),F=c.useRef(null),U=c.useCallback(()=>{J(o=>!o)},[]);c.useEffect(()=>{(async()=>{try{const t=await fetch("https://code-me-n0t.github.io/TestFlowManager/flow.json");if(t.ok){const n=await t.json(),{x:a=0,y:x=0,zoom:z=1}=n.viewport||{},p=(n.nodes||[]).map(i=>{var b,E,L;return{...i,position:{x:typeof((b=i.position)==null?void 0:b.x)=="number"?i.position.x:0,y:typeof((E=i.position)==null?void 0:E.y)=="number"?i.position.y:0},style:{backgroundColor:((L=i.style)==null?void 0:L.backgroundColor)||"inherit"}}}),g=(n.edges||[]).map(i=>({...i}));r(p),s(g),M({x:a,y:x,zoom:z}),n.nodes&&P(B(n.nodes)),h&&h.fitView()}else console.warn("Failed to load flow data: Check the flow.json")}catch(t){console.error("Failed to load flow data:",t)}})()},[r,s,M,P,h]);const K=c.useCallback(o=>s(t=>ce({...o,animated:!0,type:"customEdge"},t)),[s]),Q=c.useCallback(()=>{const o=u[u.length-1],t=o?o.position:{x:0,y:0},n={id:q(),position:{x:t.x+100,y:t.y+100},data:{label:`Test Scenario ${u.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};r(a=>[...a,n])},[u,r]),X=c.useCallback(()=>{const o=u[u.length-1],t=o?o.position:{x:0,y:0},n={id:q(),position:{x:t.x+100,y:t.y+100},type:"connector",data:{label:`${u.length+1}`},sourcePosition:"right",targetPosition:"left"};r(a=>[...a,n])},[u,r]),Y=c.useCallback((o,t)=>{F.current?(clearTimeout(F.current),F.current=null,k(!0)):F.current=setTimeout(()=>{F.current=null},200),r(n=>n.map(a=>a.id===t.id?{...a,selected:!0}:{...a,selected:!1})),N(t)},[r]),Z=c.useCallback(()=>{k(!1),N(null)},[]),G=c.useCallback((o,t,n)=>{r(a=>{const x=a.map(p=>p.id===l.id?{...p,data:{...p.data,label:t,testCases:o},style:{...p.style,backgroundColor:n||"#1C1C1E"},type:"customNode"}:p),z=B(x);return P(z),x})},[l,r,P]),ee=c.useCallback(async o=>{console.time("Export to Excel");const t=new re.Workbook,n=new Set,a=p=>{const g=p.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let i=g,b=1;for(;n.has(i);)i=`${g}_${b}`,b++,i.length>31&&(i=i.slice(0,31));return n.add(i),i};for(const p of o)if(p.data.testCases&&p.data.testCases.length>0){const g=p.data.label||`Sheet${o.indexOf(p)+1}`,i=a(g),b=p.data.testCases||[];console.log(`Processing node: ${g}`),console.log("Test Cases:",b);const E=t.addWorksheet(i);E.addRow(["Test ID","Test Case","Status"]),b.forEach((S,T)=>{E.addRow([T+1,S.content,S.status,S.description||""])}),(()=>{E.columns.forEach(S=>{let T=0;S.eachCell({includeEmpty:!0},$=>{const _=$.value?$.value.toString().length:0;_>T&&(T=_)}),S.width=T})})(),console.timeEnd(`Creating sheet for ${i}`)}console.timeEnd("Export to Excel");const x=await t.xlsx.writeBuffer(),z=new Blob([x],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ie.saveAs(z,"test_cases.xlsx"),console.log("File saved!")},[]),B=c.useCallback(o=>{const t={total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0};return o.forEach(n=>{n.data&&n.data.testCases&&(t.total+=n.data.testCases.length,n.data.testCases.forEach(a=>{a.status==="notstarted"?t.notstarted+=1:a.status==="passed"?t.passed+=1:a.status==="failed"?t.failed+=1:a.status==="blocked"?t.blocked+=1:a.status==="notapplicable"&&(t.notapplicable+=1)}))}),t},[]),te=c.useCallback(()=>{l?(r(o=>o.filter(t=>t.id!==l.id)),s(o=>o.filter(t=>t.source!==l.id&&t.target!==l.id)),y.toastDeleteSuccess(),k(!1),N(null)):y.toastDelete()},[l,r,s,y]),se=c.useCallback(()=>{if(h){const o=h.toObject(),t=B(o.nodes),n=JSON.stringify({...o,testCaseStats:t},null,4);fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:n}).then(a=>a.json()).then(a=>{a&&y.toastSaveSuccess()}).catch(a=>{console.error("Failed to save flow data to server:",a);try{localStorage.setItem("flowData",n),y.toastSaveLocalSuccess()}catch(x){console.error("Failed to save flow data to localStorage:",x),y.toastSaveErrorLocal()}})}else y.toastSaveError()},[h]);return e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(de,{colorMode:"dark",nodes:u,nodeTypes:V,onNodesChange:m,edges:f,edgeTypes:W,onEdgesChange:d,onConnect:K,onInit:O,fitView:!0,zoomOnScroll:!1,zoomOnDoubleClick:!1,onNodeClick:Y,children:[e.jsx(ue,{}),e.jsx(pe,{}),e.jsx(fe,{}),e.jsxs(he,{position:"top-left panel",className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"button-container flex space-x-2",children:[e.jsx("button",{className:"delete p-2 rounded bg-[#3E3E3E] hover:bg-red-600 size-12",onClick:te,children:e.jsx(v,{icon:xe,size:"lg",color:"white"})}),e.jsx("button",{className:"download rounded rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:()=>ee(u),children:e.jsx(v,{icon:ge,size:"lg",color:"white"})}),e.jsx("button",{className:"add p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:Q,children:e.jsx(v,{icon:be,size:"lg",color:"white"})}),e.jsx("button",{className:"connector p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:X,children:e.jsx(v,{icon:me,size:"lg",color:"white"})}),e.jsx("button",{className:"save p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:se,children:e.jsx(v,{icon:Ce,size:"lg",color:"white"})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-[#2d2d2d] opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Total Test Count: ",w.total]}),e.jsx("button",{className:"dropdown-button p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] flex items-center",onClick:U,children:e.jsx(v,{icon:ye,size:"lg",color:"white"})})]}),H&&e.jsxs("div",{className:"dropdown-menu mt-2 bg-[#2d2d2d] p-2 opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Not Started: ",w.notstarted]}),e.jsxs("p",{children:["Passed: ",w.passed]}),e.jsxs("p",{children:["Failed: ",w.failed]}),e.jsxs("p",{children:["Blocked: ",w.blocked]}),e.jsxs("p",{children:["Not Applicable: ",w.notapplicable]})]})]})]})]}),e.jsx(we,{}),e.jsx(ve,{isOpen:C,onClose:Z,nodeId:l==null?void 0:l.id,nodeLabel:((R=l==null?void 0:l.data)==null?void 0:R.label)||"",testCases:((A=l==null?void 0:l.data)==null?void 0:A.testCases)||[],onSave:G,borderColor:((I=l==null?void 0:l.data)==null?void 0:I.color)||"#1C1C1E"})]})}const Te=Ee.createRoot(document.getElementById("root"));Te.render(e.jsx(Se.StrictMode,{children:e.jsx(je,{children:e.jsx(ze,{})})}));
