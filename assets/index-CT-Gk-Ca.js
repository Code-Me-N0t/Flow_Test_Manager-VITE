import{j as e,H as z,g as te,u as se,c as oe,r as c,d as ae,B as w,e as le,v as R,h as L,w as ne,i as ce,k as re,M as ie,C as de,P as ue,F as E,b as pe,l as he,m as fe,n as xe,o as ge,p as be,Q as Ce,q as me,R as ye,s as je}from"./vendor-C_ooNTk6.js";import{M as we}from"./components-DS76Bw7M.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))f(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const b of i.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&f(b)}).observe(document,{childList:!0,subtree:!0});function g(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function f(o){if(o.ep)return;o.ep=!0;const i=g(o);fetch(o.href,i)}})();const Ee=({data:d,selected:r})=>{const{label:g,testCases:f,color:o}=d,i=f.length;return e.jsxs("div",{className:`text-xs outline rounded relative p-2 text-[#ECF0F1] max-w-[150px] text-center ${r?"outline-[#2980B9]":"outline-[#373737]"}`,children:[e.jsx("div",{children:g}),e.jsx(z,{type:"source",position:"right"}),e.jsx(z,{type:"target",position:"left"}),i>0&&e.jsx("div",{className:"absolute top-[-10px] right-[-10px] w-[20px] h-[20px] rounded-full bg-[#E0E0E0] text-slate-700 flex items-center justify-center text-xs",children:i})]})},Se=({data:d})=>e.jsxs("div",{className:"text-[#ECF0F1] text-xs rounded-full w-[50px] h-[50px] flex justify-center items-center bg-[#34495E]",children:[e.jsx("div",{children:d.label}),e.jsx(z,{type:"source",position:"right"}),e.jsx(z,{type:"target",position:"left"})]}),ve=({id:d,sourceX:r,sourceY:g,targetX:f,targetY:o,sourcePosition:i,targetPosition:b,markerEnd:S,data:l})=>{const[v,x,D]=te({sourceX:r,sourceY:g,targetX:f,targetY:o,sourcePosition:i,targetPosition:b});return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:d,className:"stroke-[#BDC3C7] stroke-[2] fill-none",d:v,markerEnd:S}),(l==null?void 0:l.label)&&e.jsx("text",{x,y:D,style:{fontSize:12},textAnchor:"middle",children:l.label})]})};function ke(){var M,A,I;const[d,r,g]=se([]),[f,o,i]=oe([]),[b,S]=c.useState(!1),[l,v]=c.useState(null),[x,D]=c.useState(null),{setViewport:B}=ae(),_={customNode:Ee,connector:Se},$={customEdge:ve},C={toastDelete:c.useCallback(()=>{w.error("No node selected to delete.",{autoClose:1e3})},[]),toastDeleteSuccess:c.useCallback(()=>{w.success("Node Deleted.",{autoClose:1e3})},[]),toastSaveError:c.useCallback(()=>{w.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),toastSaveSuccess:c.useCallback(()=>{w.success("Changes saved successfully!",{autoClose:1e3})},[]),toastSaveErrorLocal:c.useCallback(()=>{w.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),toastSaveLocalSuccess:c.useCallback(()=>{w.success("Changes saved locally!",{autoClose:1e3})},[])},[m,F]=c.useState({total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0}),[q,V]=c.useState(!1),k=c.useRef(null),H=c.useCallback(()=>{V(a=>!a)},[]);c.useEffect(()=>{(async()=>{try{const t=await fetch("https://code-me-n0t.github.io/TestFlowManager/flow.json");if(t.ok){const n=await t.json(),{x:s=0,y:h=0,zoom:y=1}=n.viewport||{},u=(n.nodes||[]).map(p=>{var T,P,j;return{...p,position:{x:typeof((T=p.position)==null?void 0:T.x)=="number"?p.position.x:0,y:typeof((P=p.position)==null?void 0:P.y)=="number"?p.position.y:0},style:{backgroundColor:((j=p.style)==null?void 0:j.backgroundColor)||"inherit"}}}),N=(n.edges||[]).map(p=>({...p}));r(u),o(N),B({x:s,y:h,zoom:y}),n.nodes&&F(O(n.nodes)),x&&x.fitView()}else console.warn("Failed to load flow data: Check the flow.json")}catch(t){console.error("Failed to load flow data:",t)}})()},[r,o,B,F,x]);const U=c.useCallback(a=>o(t=>le({...a,animated:!0,type:"customEdge"},t)),[o]),J=c.useCallback(()=>{const a=d[d.length-1],t=a?a.position:{x:0,y:0},n={id:R(),position:{x:t.x+100,y:t.y+100},data:{label:`Test Scenario ${d.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};r(s=>[...s,n])},[d,r]),K=c.useCallback(()=>{const a=d[d.length-1],t=a?a.position:{x:0,y:0},n={id:R(),position:{x:t.x+100,y:t.y+100},type:"connector",data:{label:`${d.length+1}`},sourcePosition:"right",targetPosition:"left"};r(s=>[...s,n])},[d,r]),Q=c.useCallback((a,t)=>{k.current?(clearTimeout(k.current),k.current=null,S(!0)):k.current=setTimeout(()=>{k.current=null},200),r(n=>n.map(s=>s.id===t.id?{...s,selected:!0}:{...s,selected:!1})),v(t)},[r]),W=c.useCallback(()=>{S(!1),v(null)},[]),X=c.useCallback((a,t,n)=>{r(s=>{const h=s.map(u=>u.id===l.id?{...u,data:{...u.data,label:t,testCases:a},style:{...u.style,backgroundColor:n||"#1C1C1E"},type:"customNode"}:u),y=O(h);return F(y),h})},[l,r,F]),Y=c.useCallback(a=>{console.time("Export to Excel");const t=L.book_new(),n=new Set;a.filter(s=>s.data.testCases&&s.data.testCases.length>0).forEach(s=>{const h=s.data.label||`Sheet${a.indexOf(s)+1}`,y=h.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let u=y,N=1;for(;n.has(u);)u=`${y}_${N}`,N++,u.length>31&&(u=u.slice(0,31));n.add(u);const p=s.data.testCases||[];console.log(`Processing node: ${h}`),console.log("Test Cases:",p);const T=p.map((j,ee)=>({"Test Case ID":ee+1,"Test Case Name":j.content,"Test Case Status":j.status,"Test Case Description":j.description||""}));console.time(`Creating sheet for ${u}`);const P=L.json_to_sheet(T);L.book_append_sheet(t,P,u),console.timeEnd(`Creating sheet for ${u}`)}),console.timeEnd("Export to Excel"),ne(t,"test_cases.xlsx")},[]),O=c.useCallback(a=>{const t={total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0};return a.forEach(n=>{n.data&&n.data.testCases&&(t.total+=n.data.testCases.length,n.data.testCases.forEach(s=>{s.status==="notstarted"?t.notstarted+=1:s.status==="passed"?t.passed+=1:s.status==="failed"?t.failed+=1:s.status==="blocked"?t.blocked+=1:s.status==="notapplicable"&&(t.notapplicable+=1)}))}),t},[]),Z=c.useCallback(()=>{l?(r(a=>a.filter(t=>t.id!==l.id)),o(a=>a.filter(t=>t.source!==l.id&&t.target!==l.id)),C.toastDeleteSuccess(),S(!1),v(null)):C.toastDelete()},[l,r,o,C]),G=c.useCallback(()=>{if(x){const a=x.toObject(),t=O(a.nodes),n=JSON.stringify({...a,testCaseStats:t},null,4);fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:n}).then(s=>s.json()).then(s=>{s&&C.toastSaveSuccess()}).catch(s=>{console.error("Failed to save flow data to server:",s);try{localStorage.setItem("flowData",n),C.toastSaveLocalSuccess()}catch(h){console.error("Failed to save flow data to localStorage:",h),C.toastSaveErrorLocal()}})}else C.toastSaveError()},[x]);return e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(ce,{colorMode:"dark",nodes:d,nodeTypes:_,onNodesChange:g,edges:f,edgeTypes:$,onEdgesChange:i,onConnect:U,onInit:D,fitView:!0,zoomOnScroll:!1,zoomOnDoubleClick:!1,onNodeClick:Q,children:[e.jsx(re,{}),e.jsx(ie,{}),e.jsx(de,{}),e.jsxs(ue,{position:"top-left panel",className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"button-container flex space-x-2",children:[e.jsx("button",{className:"delete p-2 rounded bg-[#3E3E3E] hover:bg-red-600 size-12",onClick:Z,children:e.jsx(E,{icon:pe,size:"lg",color:"white"})}),e.jsx("button",{className:"download rounded rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:()=>Y(d),children:e.jsx(E,{icon:he,size:"lg",color:"white"})}),e.jsx("button",{className:"add p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:J,children:e.jsx(E,{icon:fe,size:"lg",color:"white"})}),e.jsx("button",{className:"connector p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:K,children:e.jsx(E,{icon:xe,size:"lg",color:"white"})}),e.jsx("button",{className:"save p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:G,children:e.jsx(E,{icon:ge,size:"lg",color:"white"})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-[#2d2d2d] opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Total Test Count: ",m.total]}),e.jsx("button",{className:"dropdown-button p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] flex items-center",onClick:H,children:e.jsx(E,{icon:be,size:"lg",color:"white"})})]}),q&&e.jsxs("div",{className:"dropdown-menu mt-2 bg-[#2d2d2d] p-2 opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Not Started: ",m.notstarted]}),e.jsxs("p",{children:["Passed: ",m.passed]}),e.jsxs("p",{children:["Failed: ",m.failed]}),e.jsxs("p",{children:["Blocked: ",m.blocked]}),e.jsxs("p",{children:["Not Applicable: ",m.notapplicable]})]})]})]})]}),e.jsx(Ce,{}),e.jsx(we,{isOpen:b,onClose:W,nodeId:l==null?void 0:l.id,nodeLabel:((M=l==null?void 0:l.data)==null?void 0:M.label)||"",testCases:((A=l==null?void 0:l.data)==null?void 0:A.testCases)||[],onSave:X,borderColor:((I=l==null?void 0:l.data)==null?void 0:I.color)||"#1C1C1E"})]})}const Ne=me.createRoot(document.getElementById("root"));Ne.render(e.jsx(ye.StrictMode,{children:e.jsx(je,{children:e.jsx(ke,{})})}));
